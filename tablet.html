<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sermão Digital</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f7;
            margin: 0;
        }

        header {
            background: #1a237e;
            color: white;
            padding: 20px;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 32px;
        }

        .container {
            padding: 20px;
        }

        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #1a237e;
            margin-bottom: 10px;
        }

        textarea {
            width: 100%;
            height: 140px;
            border-radius: 12px;
            border: 1px solid #ccc;
            padding: 12px;
            font-size: 18px;
            outline: none;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #ccc;
            margin: 10px 0;
            font-size: 16px;
        }

        button {
            background: #1a237e;
            color: white;
            padding: 12px 18px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #0d164e;
        }

        .mini-btn {
            background: #d4af37;
            color: black;
            padding: 8px 14px;
            font-size: 14px;
            margin-left: 5px;
            border-radius: 8px;
            border: none;
        }

        .slide-list {
            margin-top: 20px;
        }

        .slide-item {
            background: #f8f8ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 6px solid #1a237e;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #d4af37;
            color: black;
            padding: 12px 20px;
            border-radius: 10px;
            display: none;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>

<body>

<header>
    <h1>SERMÃO DIGITAL - CRIADOR DE SLIDES</h1>
</header>

<div id="notification" class="notification"></div>

<div class="container">

    <!-- CRIAR SLIDE -->
    <div class="section">
        <h2>Criar Slide</h2>

        <textarea id="slideText" placeholder="Digite o conteúdo do slide..."></textarea>

        <label>Cor do texto:</label>
        <input type="color" id="textColor" value="#1a237e">

        <label>Tamanho do texto:</label>
        <select id="textSize">
            <option value="32px">Normal</option>
            <option value="40px">Grande</option>
            <option value="52px">Muito grande</option>
            <option value="64px">Enorme</option>
        </select>

        <label>Imagem de fundo (opcional):</label>
        <input type="text" id="bgUrl" placeholder="URL da imagem (opcional)">

        <button onclick="addSlide()">Adicionar Slide</button>
    </div>

    <!-- BÍBLIA -->
    <div class="section">
        <h2>Adicionar Versículo</h2>

        <input id="ref" placeholder="Ex: João 3:16">
        <textarea id="verseText" placeholder="Texto bíblico"></textarea>

        <button onclick="addBibleSlide()">Adicionar Versículo</button>
    </div>

    <!-- LISTA DE SLIDES -->
    <div class="section">
        <h2>Slides Criados</h2>
        <div id="slidesList"></div>
    </div>

    <!-- CONTROLE -->
    <div class="section">
        <h2>Controle</h2>

        <button onclick="startPresentation()">Iniciar Apresentação</button>
        <button onclick="togglePlay()" class="mini-btn">Play/Pause</button>

        <button onclick="saveSermon()" class="mini-btn">Salvar Sermão</button>
        <button onclick="loadSermon()" class="mini-btn">Carregar Sermão</button>
    </div>

</div>

<script>

let slides = [];
let currentSlide = 0;
let playing = false;
let projectionSocket = null;

/* ------------------------------------------
   SISTEMA DE NOTIFICAÇÃO
-------------------------------------------*/
function notify(msg) {
    const n = document.getElementById('notification');
    n.innerText = msg;
    n.style.display = "block";
    setTimeout(() => n.style.display = "none", 3000);
}

/* ------------------------------------------
   ADICIONAR SLIDE COMUM
-------------------------------------------*/

function addSlide() {
    const text = document.getElementById("slideText").value.trim();
    if (!text) return notify("Digite algo!");

    const slide = {
        type: "SLIDE",
        content: text,
        color: document.getElementById("textColor").value,
        size: document.getElementById("textSize").value,
        bg: document.getElementById("bgUrl").value.trim()
    };

    slides.push(slide);
    renderSlides();
    notify("Slide adicionado!");
}

/* ------------------------------------------
   ADICIONAR SLIDE BÍBLICO
-------------------------------------------*/

function addBibleSlide() {
    const ref = document.getElementById("ref").value.trim();
    const text = document.getElementById("verseText").value.trim();
    if (!ref || !text) return notify("Preencha referência e texto!");

    const slide = {
        type: "BIBLE_VERSE",
        content: text,
        reference: ref,
        color: "#d4af37",
        size: "48px",
        bg: ""
    };

    slides.push(slide);
    renderSlides();
    notify("Versículo adicionado!");
}

/* ------------------------------------------
   LISTA DE SLIDES
-------------------------------------------*/

function renderSlides() {
    const list = document.getElementById("slidesList");
    list.innerHTML = "";

    slides.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "slide-item";
        div.innerHTML = `<b>${i + 1}.</b> ${s.type === "BIBLE_VERSE" ? "(Versículo)" : ""} ${s.content.substring(0, 100)}...`;
        list.appendChild(div);
    });
}

/* ------------------------------------------
   SALVAR E CARREGAR
-------------------------------------------*/

function saveSermon() {
    const blob = new Blob([JSON.stringify(slides)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "sermao.json";
    a.click();
    notify("Sermão salvo!");
}

function loadSermon() {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = ".json";

    input.onchange = e => {
        const reader = new FileReader();
        reader.onload = r => {
            slides = JSON.parse(r.target.result);
            renderSlides();
            notify("Sermão carregado!");
        };
        reader.readAsText(e.target.files[0]);
    };

    input.click();
}/* ------------------------------------------
   CONECTAR AO PROJETOR
-------------------------------------------*/

function connectSocket() {
    if (projectionSocket && projectionSocket.readyState === WebSocket.OPEN) return;

    const url = location.hostname === "localhost"
        ? "ws://localhost:10000"
        : "wss://sermao-digital.onrender.com";

    projectionSocket = new WebSocket(url);

    projectionSocket.onopen = () => notify("Conectado ao projetor");
    projectionSocket.onerror = () => notify("Erro ao conectar ao projetor");
}

/* ------------------------------------------
   ENVIAR SLIDE PARA PROJEÇÃO
-------------------------------------------*/

function showSlide(index) {
    if (index < 0 || index >= slides.length) return;

    currentSlide = index;

    const data = {
        type: slides[index].type,
        slide: slides[index]
    };

    connectSocket();

    setTimeout(() => {
        if (projectionSocket.readyState === WebSocket.OPEN) {
            projectionSocket.send(JSON.stringify(data));
            notify(`Slide ${index + 1} enviado`);
        }
    }, 200);
}

/* ------------------------------------------
   INICIAR APRESENTAÇÃO
-------------------------------------------*/

function startPresentation() {
    if (slides.length === 0) return notify("Nenhum slide criado!");

    currentSlide = 0;
    playing = true;

    const data = { type: "PRESENTATION_START", slide: slides[0] };
    connectSocket();

    setTimeout(() => {
        projectionSocket.send(JSON.stringify(data));
    }, 200);

    loopSlides();
    notify("Apresentação iniciada!");
}

/* ------------------------------------------
   LOOP DOS SLIDES
-------------------------------------------*/

function loopSlides() {
    if (!playing) return;
    showSlide(currentSlide);

    currentSlide++;
    if (currentSlide >= slides.length) currentSlide = 0;

    setTimeout(loopSlides, 5000);
}

/* ------------------------------------------
   PLAY / PAUSE
-------------------------------------------*/

function togglePlay() {
    playing = !playing;
    notify(playing ? "Retomado" : "Pausado");

    if (playing) loopSlides();
}

</script>

</body>
</html>
